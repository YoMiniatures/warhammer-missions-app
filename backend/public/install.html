<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f0f10">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">
    <link rel="icon" type="image/png" href="/favicon.png">
    <title>Instalar WH Vault</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#d41132",
                        "primary-dark": "#8a0b20",
                        "secondary": "#c5a065",
                        "background-dark": "#0f0f10",
                        "surface-dark": "#1a1718",
                    },
                },
            },
        }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #0f0f10;
            color: #e5e7eb;
            min-height: 100dvh;
        }
        .glow-text { text-shadow: 0 0 20px rgba(212, 17, 50, 0.5); }
        .glow-box { box-shadow: 0 0 30px rgba(212, 17, 50, 0.3); }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(212, 17, 50, 0.4); }
            50% { box-shadow: 0 0 40px rgba(212, 17, 50, 0.8); }
        }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .float { animation: float 3s ease-in-out infinite; }

        .step-card {
            background: linear-gradient(145deg, #1a1718 0%, #0f0f10 100%);
            border: 1px solid #332224;
        }
    </style>
</head>
<body>
    <div class="min-h-screen flex flex-col max-w-md mx-auto border-x border-[#332224]">

        <!-- Header -->
        <header class="bg-[#221618] border-b border-[#332224] p-4">
            <div class="flex items-center justify-center gap-3">
                <img src="/assets/icons/icon-192.png" alt="WH Vault" class="w-10 h-10 rounded-lg float">
                <div>
                    <h1 class="text-white text-lg font-bold">WARHAMMER VAULT</h1>
                    <p class="text-secondary text-[10px] tracking-widest">ROGUE TRADER EDITION</p>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 p-6 flex flex-col items-center justify-center gap-8">

            <!-- Status Section -->
            <div id="status-section" class="text-center">
                <div id="status-checking" class="flex flex-col items-center gap-4">
                    <span class="material-symbols-outlined text-6xl text-secondary animate-pulse">hourglass_empty</span>
                    <p class="text-gray-400 font-mono text-sm">/// VERIFICANDO ESTADO ///</p>
                </div>

                <div id="status-installed" class="hidden flex-col items-center gap-4">
                    <span class="material-symbols-outlined text-6xl text-green-500">check_circle</span>
                    <h2 class="text-white text-2xl font-bold glow-text">APP INSTALADA</h2>
                    <p class="text-gray-400 text-sm">La aplicacion ya esta instalada en tu dispositivo.</p>
                    <a href="/index.html" class="mt-4 bg-primary hover:bg-primary-dark text-white px-8 py-3 font-bold uppercase tracking-wider transition-colors">
                        Abrir App
                    </a>
                </div>

                <div id="status-installable" class="hidden flex-col items-center gap-6">
                    <div class="w-24 h-24 rounded-2xl bg-[#1a1718] border-2 border-primary flex items-center justify-center pulse-glow">
                        <img src="/assets/icons/icon-192.png" alt="WH Vault" class="w-16 h-16">
                    </div>
                    <div class="text-center">
                        <h2 class="text-white text-2xl font-bold glow-text mb-2">INSTALAR APP</h2>
                        <p class="text-gray-400 text-sm max-w-xs">Acceso offline, notificaciones y experiencia nativa.</p>
                    </div>

                    <!-- Install Button (Chrome/Edge) -->
                    <button id="install-btn" class="hidden bg-primary hover:bg-primary-dark text-white px-8 py-4 font-bold uppercase tracking-wider transition-all glow-box hover:scale-105">
                        <span class="flex items-center gap-2">
                            <span class="material-symbols-outlined">download</span>
                            Instalar Ahora
                        </span>
                    </button>
                </div>
            </div>

            <!-- Instructions Section -->
            <div id="instructions-section" class="hidden w-full max-w-sm">
                <h3 class="text-secondary text-xs font-bold tracking-widest uppercase mb-4 text-center">
                    /// INSTRUCCIONES DE INSTALACION ///
                </h3>

                <!-- iOS Instructions -->
                <div id="ios-instructions" class="hidden space-y-3">
                    <div class="step-card p-4 rounded">
                        <div class="flex items-start gap-3">
                            <span class="bg-primary text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold shrink-0">1</span>
                            <div>
                                <p class="text-white text-sm font-medium">Toca el boton Compartir</p>
                                <p class="text-gray-500 text-xs mt-1">El icono de cuadrado con flecha hacia arriba en la barra inferior de Safari</p>
                                <div class="mt-2 flex items-center gap-2 text-secondary">
                                    <span class="material-symbols-outlined text-2xl">ios_share</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card p-4 rounded">
                        <div class="flex items-start gap-3">
                            <span class="bg-primary text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold shrink-0">2</span>
                            <div>
                                <p class="text-white text-sm font-medium">Selecciona "Anadir a Inicio"</p>
                                <p class="text-gray-500 text-xs mt-1">Desliza hacia abajo en el menu y busca esta opcion</p>
                                <div class="mt-2 flex items-center gap-2 text-secondary">
                                    <span class="material-symbols-outlined text-2xl">add_box</span>
                                    <span class="text-xs">Anadir a pantalla de inicio</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card p-4 rounded">
                        <div class="flex items-start gap-3">
                            <span class="bg-primary text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold shrink-0">3</span>
                            <div>
                                <p class="text-white text-sm font-medium">Confirma "Anadir"</p>
                                <p class="text-gray-500 text-xs mt-1">Toca el boton Anadir en la esquina superior derecha</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Android Chrome Instructions -->
                <div id="android-instructions" class="hidden space-y-3">
                    <div class="step-card p-4 rounded">
                        <div class="flex items-start gap-3">
                            <span class="bg-primary text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold shrink-0">1</span>
                            <div>
                                <p class="text-white text-sm font-medium">Abre el menu de Chrome</p>
                                <p class="text-gray-500 text-xs mt-1">Toca los tres puntos verticales en la esquina superior derecha</p>
                                <div class="mt-2 flex items-center gap-2 text-secondary">
                                    <span class="material-symbols-outlined text-2xl">more_vert</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card p-4 rounded">
                        <div class="flex items-start gap-3">
                            <span class="bg-primary text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold shrink-0">2</span>
                            <div>
                                <p class="text-white text-sm font-medium">Selecciona "Instalar app" o "Anadir a Inicio"</p>
                                <p class="text-gray-500 text-xs mt-1">La opcion puede variar segun la version de Chrome</p>
                                <div class="mt-2 flex items-center gap-2 text-secondary">
                                    <span class="material-symbols-outlined text-2xl">install_mobile</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card p-4 rounded">
                        <div class="flex items-start gap-3">
                            <span class="bg-primary text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold shrink-0">3</span>
                            <div>
                                <p class="text-white text-sm font-medium">Confirma la instalacion</p>
                                <p class="text-gray-500 text-xs mt-1">Toca "Instalar" en el dialogo de confirmacion</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Desktop Instructions -->
                <div id="desktop-instructions" class="hidden space-y-3">
                    <div class="step-card p-4 rounded">
                        <div class="flex items-start gap-3">
                            <span class="bg-primary text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold shrink-0">1</span>
                            <div>
                                <p class="text-white text-sm font-medium">Busca el icono de instalacion</p>
                                <p class="text-gray-500 text-xs mt-1">En la barra de direcciones, al lado derecho</p>
                                <div class="mt-2 flex items-center gap-2 text-secondary">
                                    <span class="material-symbols-outlined text-2xl">install_desktop</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="step-card p-4 rounded">
                        <div class="flex items-start gap-3">
                            <span class="bg-primary text-white w-6 h-6 rounded-full flex items-center justify-center text-sm font-bold shrink-0">2</span>
                            <div>
                                <p class="text-white text-sm font-medium">Haz clic en "Instalar"</p>
                                <p class="text-gray-500 text-xs mt-1">Confirma en el dialogo que aparece</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features -->
            <div class="w-full max-w-sm mt-4">
                <div class="grid grid-cols-3 gap-3 text-center">
                    <div class="bg-[#1a1718] border border-[#332224] p-3 rounded">
                        <span class="material-symbols-outlined text-primary text-2xl">wifi_off</span>
                        <p class="text-[10px] text-gray-400 mt-1 uppercase tracking-wider">Offline</p>
                    </div>
                    <div class="bg-[#1a1718] border border-[#332224] p-3 rounded">
                        <span class="material-symbols-outlined text-primary text-2xl">bolt</span>
                        <p class="text-[10px] text-gray-400 mt-1 uppercase tracking-wider">Rapida</p>
                    </div>
                    <div class="bg-[#1a1718] border border-[#332224] p-3 rounded">
                        <span class="material-symbols-outlined text-primary text-2xl">home_app_logo</span>
                        <p class="text-[10px] text-gray-400 mt-1 uppercase tracking-wider">Nativa</p>
                    </div>
                </div>
            </div>

        </main>

        <!-- Footer -->
        <footer class="p-4 border-t border-[#332224] text-center">
            <a href="/index.html" class="text-gray-500 hover:text-secondary text-sm transition-colors">
                Continuar en navegador â†’
            </a>
        </footer>

    </div>

    <script>
        // PWA Install state
        let deferredPrompt = null;
        let isInstalled = false;

        // Detect device type
        function getDeviceType() {
            const ua = navigator.userAgent;
            if (/iPad|iPhone|iPod/.test(ua)) return 'ios';
            if (/Android/.test(ua)) return 'android';
            return 'desktop';
        }

        // Check if running as installed PWA
        function checkIfInstalled() {
            // Check display-mode
            if (window.matchMedia('(display-mode: standalone)').matches) return true;
            // Check iOS standalone
            if (window.navigator.standalone === true) return true;
            // Check if launched from home screen (Android)
            if (document.referrer.includes('android-app://')) return true;
            return false;
        }

        // Update UI based on state
        function updateUI() {
            const deviceType = getDeviceType();

            document.getElementById('status-checking').classList.add('hidden');

            if (checkIfInstalled()) {
                // Already installed
                document.getElementById('status-installed').classList.remove('hidden');
                document.getElementById('status-installed').classList.add('flex');
                document.getElementById('instructions-section').classList.add('hidden');
            } else {
                // Not installed - show install options
                document.getElementById('status-installable').classList.remove('hidden');
                document.getElementById('status-installable').classList.add('flex');
                document.getElementById('instructions-section').classList.remove('hidden');

                // Show device-specific instructions
                if (deviceType === 'ios') {
                    document.getElementById('ios-instructions').classList.remove('hidden');
                } else if (deviceType === 'android') {
                    document.getElementById('android-instructions').classList.remove('hidden');
                    // Also show install button if available
                    if (deferredPrompt) {
                        document.getElementById('install-btn').classList.remove('hidden');
                    }
                } else {
                    document.getElementById('desktop-instructions').classList.remove('hidden');
                    // Show install button if available
                    if (deferredPrompt) {
                        document.getElementById('install-btn').classList.remove('hidden');
                    }
                }
            }
        }

        // Listen for beforeinstallprompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Show install button
            const installBtn = document.getElementById('install-btn');
            installBtn.classList.remove('hidden');

            console.log('[Install] beforeinstallprompt captured');
        });

        // Install button click handler
        document.getElementById('install-btn').addEventListener('click', async () => {
            if (!deferredPrompt) {
                console.log('[Install] No deferred prompt available');
                return;
            }

            // Show the install prompt
            deferredPrompt.prompt();

            // Wait for user response
            const { outcome } = await deferredPrompt.userChoice;
            console.log('[Install] User choice:', outcome);

            if (outcome === 'accepted') {
                // Refresh the page to show installed state
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }

            deferredPrompt = null;
        });

        // Listen for app installed event
        window.addEventListener('appinstalled', () => {
            console.log('[Install] App was installed');
            deferredPrompt = null;
            updateUI();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Small delay to allow beforeinstallprompt to fire
            setTimeout(updateUI, 500);
        });

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then((registration) => {
                    console.log('[Install] SW registered');
                })
                .catch((error) => {
                    console.log('[Install] SW registration failed:', error);
                });
        }
    </script>
</body>
</html>
