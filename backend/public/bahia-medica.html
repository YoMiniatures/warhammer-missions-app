<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f0f10">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/assets/icons/icon-192.png">
    <link rel="icon" type="image/png" href="/favicon.png">
    <title>Bah√≠a M√©dica - Medicae Pod</title>

    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#d41132",
                        "primary-dark": "#8a0b20",
                        "secondary": "#c5a065",
                        "accent-cogitator": "#2efc84",
                        "medical-green": "#22c55e",
                        "medical-scan": "#0ea5e9",
                        "background-dark": "#0f0f10",
                        "surface-dark": "#1a1718",
                        "surface-accent": "#261e1f",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"],
                        "body": ["Noto Sans", "sans-serif"],
                    },
                },
            },
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=swap" rel="stylesheet">

    <style>
        /* Material Symbols config */
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #0f0f10;
            color: #e5e7eb;
            -webkit-font-smoothing: antialiased;
            min-height: 100dvh;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #181112; }
        ::-webkit-scrollbar-thumb { background: #543b3f; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #d41132; }

        /* Selection */
        ::selection { background-color: #d41132; color: white; }

        /* Scanlines */
        .scanlines {
            background-image: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                              linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 6px 100%;
            pointer-events: none;
        }

        /* Hide scrollbar */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Pod container */
        .medicae-pod {
            background: radial-gradient(ellipse at center, #0a1a1a 0%, #050a0a 100%);
            border: 2px solid rgba(34, 197, 94, 0.3);
            box-shadow:
                inset 0 0 60px rgba(34, 197, 94, 0.1),
                0 0 30px rgba(34, 197, 94, 0.2);
            position: relative;
            overflow: hidden;
        }

        /* Scanning animation */
        @keyframes scan {
            0% { top: -10%; opacity: 0; }
            50% { opacity: 0.8; }
            100% { top: 110%; opacity: 0; }
        }
        .scan-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to bottom,
                transparent,
                rgba(34, 197, 94, 0.8),
                transparent
            );
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.8);
            animation: scan 3s linear infinite;
            pointer-events: none;
        }

        /* Body zone overlays */
        .zone-overlay {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(34, 197, 94, 0.5) !important;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(34, 197, 94, 0.15);
            animation: blink-zone 2s ease-in-out infinite;
        }
        .zone-overlay:hover {
            background: rgba(34, 197, 94, 0.3);
            border: 2px solid rgba(34, 197, 94, 0.8) !important;
            box-shadow: inset 0 0 15px rgba(34, 197, 94, 0.3), 0 0 20px rgba(34, 197, 94, 0.4);
            animation: none;
        }
        .zone-overlay.active {
            background: rgba(34, 197, 94, 0.3);
            border: 2px solid #22c55e !important;
            animation: pulse-zone 1.5s ease-in-out infinite;
        }

        .zone-label {
            color: #22c55e;
            font-size: 10px;
            font-weight: bold;
            font-family: monospace;
            text-transform: uppercase;
            text-shadow: 0 0 5px rgba(34, 197, 94, 0.8);
            opacity: 1;
            transition: opacity 0.3s ease;
            pointer-events: none;
            background: rgba(0, 0, 0, 0.7);
            padding: 2px 4px;
            border-radius: 2px;
        }

        /* Blink animation for positioning */
        @keyframes blink-zone {
            0%, 100% {
                opacity: 0.6;
                border-color: rgba(34, 197, 94, 0.5);
            }
            50% {
                opacity: 1;
                border-color: rgba(34, 197, 94, 1);
                box-shadow: 0 0 15px rgba(34, 197, 94, 0.6);
            }
        }

        @keyframes pulse-zone {
            0%, 100% {
                box-shadow: inset 0 0 15px rgba(34, 197, 94, 0.3), 0 0 20px rgba(34, 197, 94, 0.5);
                background: rgba(34, 197, 94, 0.25);
            }
            50% {
                box-shadow: inset 0 0 25px rgba(34, 197, 94, 0.5), 0 0 30px rgba(34, 197, 94, 0.8);
                background: rgba(34, 197, 94, 0.35);
            }
        }

        /* Status indicator */
        .status-optimal { color: #22c55e; }
        .status-warning { color: #f59e0b; }
        .status-critical { color: #ef4444; }

        /* Zone card */
        .zone-card {
            background: linear-gradient(145deg, #1a1718, #0f0f10);
            border: 1px solid rgba(34, 197, 94, 0.3);
            box-shadow: 0 4px 12px rgba(0,0,0,0.5), inset 0 0 10px rgba(34,197,94,0.05);
            transition: all 0.2s;
        }
        .zone-card:hover {
            border-color: rgba(34, 197, 94, 0.6);
            transform: translateY(-2px);
        }

        /* Checkup item */
        .checkup-item {
            background: rgba(34, 197, 94, 0.05);
            border-left: 2px solid rgba(34, 197, 94, 0.5);
            transition: all 0.2s;
        }
        .checkup-item:hover {
            background: rgba(34, 197, 94, 0.1);
            border-left-color: #22c55e;
        }
        .checkup-item.overdue {
            border-left-color: #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }

        /* Modal overlay */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(4px);
        }
        .modal-content {
            background: linear-gradient(145deg, #1e1c1d, #141112);
            border: 1px solid rgba(34, 197, 94, 0.4);
            box-shadow: 0 8px 32px rgba(0,0,0,0.8), inset 0 0 20px rgba(34,197,94,0.1);
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
        }
        .modal-header {
            border-bottom: 1px solid rgba(34, 197, 94, 0.2);
            background: linear-gradient(to bottom, rgba(34, 197, 94, 0.1), transparent);
        }

        /* Form styles */
        .form-group {
            margin-bottom: 1rem;
        }
        .form-label {
            display: block;
            color: #22c55e;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            background: #0f0f10;
            border: 1px solid rgba(34, 197, 94, 0.3);
            color: #e5e7eb;
            font-family: 'Noto Sans', sans-serif;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 10px rgba(34, 197, 94, 0.3);
        }
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Button styles */
        .btn-primary {
            background: linear-gradient(145deg, #22c55e, #16a34a);
            color: white;
            padding: 0.75rem 1.5rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-size: 0.75rem;
            border: 1px solid rgba(34, 197, 94, 0.5);
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background: linear-gradient(145deg, #16a34a, #15803d);
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.5);
        }
        .btn-secondary {
            background: transparent;
            color: #22c55e;
            padding: 0.75rem 1.5rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-size: 0.75rem;
            border: 1px solid rgba(34, 197, 94, 0.3);
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-secondary:hover {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.1);
        }

        /* Toast notification */
        .toast {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background: #16a34a;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 2px;
            font-size: 0.875rem;
            font-weight: bold;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: toastIn 0.3s ease;
        }
        @keyframes toastIn {
            from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        /* Pending sync badge */
        .pending-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            min-width: 14px;
            height: 14px;
            background: #f59e0b;
            border-radius: 9999px;
            font-size: 9px;
            font-weight: bold;
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 3px;
            border: 2px solid #221618;
            z-index: 10;
        }
        .pending-badge.hidden { display: none; }

        /* Edit mode styles */
        .edit-mode-btn {
            background: rgba(212,17,50,0.15);
            border: 1px solid rgba(212,17,50,0.5);
            border-radius: 4px;
            color: rgba(212,17,50,0.8);
            cursor: pointer;
            padding: 0.25rem 0.4rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        .edit-mode-btn:hover {
            background: rgba(212,17,50,0.25);
            border-color: #d41132;
            color: #d41132;
        }
        .edit-mode-btn.active {
            background: rgba(34,197,94,0.15);
            border-color: rgba(34,197,94,0.6);
            color: #22c55e;
        }

        .edit-controls {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: rgba(15, 15, 16, 0.98);
            border: 2px solid #22c55e;
            padding: 0.75rem;
            border-radius: 4px;
            display: none;
            flex-direction: row;
            flex-wrap: wrap;
            align-items: center;
            gap: 0.75rem;
            max-width: 90vw;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.8);
            cursor: move;
        }
        .edit-controls.active { display: flex; }
        .edit-controls-header {
            width: 100%;
            text-align: center;
            color: #22c55e;
            font-weight: bold;
            font-size: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(34, 197, 94, 0.3);
            cursor: move;
            user-select: none;
        }

        .edit-control-row {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
        }
        .edit-control-label {
            color: #22c55e;
            font-weight: bold;
            font-family: monospace;
            font-size: 0.7rem;
            white-space: nowrap;
        }
        .edit-control-input {
            background: #1a1a1b;
            border: 1px solid #333;
            color: #e5e7eb;
            padding: 0.35rem 0.5rem;
            font-family: monospace;
            font-size: 0.7rem;
            width: 80px;
        }
        .edit-control-btn {
            background: #1a1a1b;
            border: 1px solid #22c55e;
            color: #22c55e;
            padding: 0.35rem 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            font-size: 0.7rem;
            white-space: nowrap;
        }
        .edit-control-btn:hover {
            background: #22c55e;
            color: white;
        }

        .zone-overlay.edit-mode {
            cursor: move !important;
        }
        .zone-overlay.edit-selected {
            border-color: #d41132 !important;
            box-shadow: 0 0 20px rgba(212, 17, 50, 0.8) !important;
            animation: none !important;
        }

        /* Desktop nav styles */
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 12px 8px;
            color: #888;
            transition: all 0.2s;
            position: relative;
            width: 100%;
        }
        .nav-item:hover { color: #c5a065; background: #1e1617; }
        .nav-item.active { color: #d41132; }
        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #d41132;
            box-shadow: 0 0 8px rgba(212,17,50,0.8);
        }
        .nav-label { font-size: 8px; text-transform: uppercase; font-weight: bold; }

        /* Zoom view */
        .zoom-view {
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.4s ease;
        }
        .zoom-view.active {
            transform: scale(1);
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- === DESKTOP NAV LATERAL (hidden on mobile) === -->
    <nav id="desktop-nav" class="hidden lg:fixed lg:left-0 lg:top-0 lg:h-screen lg:w-20 lg:flex lg:flex-col lg:bg-[#161011]/90 lg:border-r lg:border-[#332224]/50 lg:backdrop-blur-md lg:z-50">
        <!-- Logo/Brand top -->
        <div class="flex items-center justify-center h-20 border-b border-[#332224]/40">
            <span class="material-symbols-outlined text-secondary text-2xl">shield_person</span>
        </div>

        <!-- Nav items vertical -->
        <div class="flex-1 flex flex-col items-center py-4 gap-2">
            <a href="index.html" class="nav-item">
                <span class="material-symbols-outlined">dashboard</span>
                <span class="nav-label">Bridge</span>
            </a>
            <a href="duty.html" class="nav-item">
                <span class="material-symbols-outlined">task_alt</span>
                <span class="nav-label">Duty</span>
            </a>
            <a href="voidmap.html" class="nav-item">
                <span class="material-symbols-outlined">public</span>
                <span class="nav-label">Void</span>
            </a>
            <a href="directivas.html" class="nav-item">
                <span class="material-symbols-outlined">target</span>
                <span class="nav-label">Direct.</span>
            </a>
            <a href="cargo.html" class="nav-item">
                <span class="material-symbols-outlined">inventory_2</span>
                <span class="nav-label">Cargo</span>
            </a>
            <a href="economato.html" class="nav-item">
                <span class="material-symbols-outlined">account_balance</span>
                <span class="nav-label">Econo.</span>
            </a>
            <a href="bahia-medica.html" class="nav-item active">
                <span class="material-symbols-outlined">medical_services</span>
                <span class="nav-label">M√©dica</span>
            </a>
        </div>

        <!-- Status bottom -->
        <div class="flex items-center justify-center h-16 border-t border-[#332224]/40">
            <div id="desktop-status-dot" class="size-3 bg-green-500 rounded-full"></div>
        </div>
    </nav>

    <div class="relative flex h-full min-h-screen w-full flex-col overflow-x-hidden bg-[#0f0f10] max-w-md mx-auto shadow-2xl border-x border-[#332224] lg:max-w-none lg:border-x-0 lg:shadow-none lg:mx-0 lg:ml-20 lg:w-[calc(100vw-5rem)] lg:pr-6">

        <!-- Scanlines overlay -->
        <div class="absolute inset-0 z-50 pointer-events-none opacity-20 scanlines h-full w-full sticky top-0"></div>

        <!-- === HEADER === -->
        <header class="lg:hidden flex items-center bg-[#221618] border-b border-[#332224] p-4 pb-3 justify-between sticky top-0 z-40 shadow-lg">
            <div class="flex shrink-0 items-center gap-3">
                <div class="relative">
                    <div class="bg-center bg-no-repeat aspect-square bg-cover rounded-sm size-10 border border-secondary/50 bg-[#1a1718] flex items-center justify-center">
                        <span class="material-symbols-outlined text-secondary text-xl">shield_person</span>
                    </div>
                    <div id="status-dot" class="absolute -bottom-1 -right-1 size-3 bg-green-500 rounded-full border-2 border-[#221618]"></div>
                    <div id="pending-badge" class="pending-badge hidden">0</div>
                </div>
                <div class="flex flex-col">
                    <span class="text-secondary text-[10px] font-bold tracking-widest uppercase">Lord Captain</span>
                    <span class="text-white text-sm font-bold leading-none">Von Valancius</span>
                </div>
            </div>
            <div class="flex flex-col items-end">
                <div class="flex items-center gap-1 text-primary text-[10px] font-mono tracking-widest mb-0.5">
                    <span class="material-symbols-outlined text-[10px]">wifi_tethering</span>
                    <span id="status-text">NOMINAL</span>
                </div>
                <div id="fecha-imperial" class="text-gray-400 font-mono text-xs">0.000.0000.M3</div>
            </div>
        </header>

        <!-- === TITLE === -->
        <div class="relative p-5 pb-4">
            <div class="absolute top-0 left-0 w-1 h-full bg-primary/20"></div>
            <h2 class="text-white tracking-tight text-3xl font-bold leading-tight uppercase font-display retro-glow">
                Bah√≠a <span class="text-medical-green">M√©dica</span>
            </h2>
            <p class="text-gray-500 text-[10px] mt-2 font-mono uppercase tracking-widest">/// MEDICAE POD - BIOSCANNER ACTIVE ///</p>
        </div>

        <!-- === TOGGLE SCANNER / HISTORIAL / AGENDA (fuera del main para no ocupar espacio) === -->
        <div class="flex items-center gap-1 mb-2 px-3 lg:px-6">
            <button id="btn-scanner" onclick="setView('scanner')"
                class="flex items-center gap-1.5 px-4 py-1.5 rounded text-[10px] font-mono font-bold uppercase tracking-widest transition-all border border-medical-green bg-medical-green/10 text-medical-green">
                <span class="material-symbols-outlined text-sm">body_system</span>SCANNER
            </button>
            <button id="btn-historial" onclick="setView('historial')"
                class="flex items-center gap-1.5 px-4 py-1.5 rounded text-[10px] font-mono font-bold uppercase tracking-widest transition-all border border-[#2d2d2d] text-gray-500 hover:border-gray-500 hover:text-gray-300">
                <span class="material-symbols-outlined text-sm">history_edu</span>HISTORIAL
            </button>
            <button id="btn-agenda" onclick="setView('agenda')"
                class="flex items-center gap-1.5 px-4 py-1.5 rounded text-[10px] font-mono font-bold uppercase tracking-widest transition-all border border-[#2d2d2d] text-gray-500 hover:border-gray-500 hover:text-gray-300">
                <span class="material-symbols-outlined text-sm">calendar_month</span>AGENDA
            </button>
            <div class="flex-1"></div>
            <!-- Bot√≥n edit mode - solo visible en SCANNER -->
            <button id="edit-mode-btn" class="edit-mode-btn hidden" onclick="toggleEditMode()" title="Editar posici√≥n de overlays">
                <span class="material-symbols-outlined" style="font-size:16px;">edit</span>
            </button>
        </div>

        <!-- === MAIN CONTENT (Scanner) === -->
        <main id="scanner-main" class="flex-1 pb-24 px-3 lg:px-6 lg:pb-6">

            <!-- === POD VIEW (Default) === -->
            <div id="pod-view" class="space-y-4">
                <!-- Medicae Pod with Body Scanner -->
                <div class="medicae-pod rounded-lg p-6 relative" style="min-height: 500px;">
                    <!-- Scanning line animation -->
                    <div class="scan-line"></div>

                    <!-- Status display -->
                    <div class="absolute top-4 left-4 right-4 flex items-center justify-between z-10">
                        <div class="bg-black/60 backdrop-blur-sm px-2 py-0.5 rounded border border-medical-green/30">
                            <span class="text-medical-green text-[10px] font-mono uppercase tracking-wider">‚óâ Scanning...</span>
                        </div>
                        <div class="bg-black/60 backdrop-blur-sm px-2 py-0.5 rounded border border-medical-green/30">
                            <span id="overall-status" class="text-medical-green text-[10px] font-mono uppercase tracking-wider">Status: Optimal</span>
                        </div>
                    </div>

                    <!-- Body scanner with clickable zones -->
                    <div class="flex items-center justify-center h-full relative">
                        <!-- Background scan image -->
                        <div class="relative w-full h-[700px]" style="background-image: url('/assets/medbay-scan.jpg'); background-size: auto 100%; background-position: center; background-repeat: no-repeat; filter: drop-shadow(0 0 15px rgba(34, 197, 94, 0.4));">

                            <!-- Clickable zone overlays (positioned over body parts) -->

                            <!-- CABEZA (Head - aligned with skeleton axis) -->
                            <div class="zone-overlay body-zone" data-zone="cabeza" onclick="selectZone('cabeza')"
                                 style="position: absolute; top: 4%; left: 50%; transform: translateX(-50%); width: 75px; height: 95px; border: 2px solid transparent; cursor: pointer;">
                                <div class="zone-label">HEAD</div>
                            </div>

                            <!-- TORSO (Chest - aligned with skeleton axis) -->
                            <div class="zone-overlay body-zone" data-zone="torso" onclick="selectZone('torso')"
                                 style="position: absolute; top: 24%; left: 50%; transform: translateX(-50%); width: 95px; height: 105px; border: 2px solid transparent; cursor: pointer;">
                                <div class="zone-label">TORSO</div>
                            </div>

                            <!-- ABDOMEN (Belly - aligned with skeleton axis) -->
                            <div class="zone-overlay body-zone" data-zone="abdomen" onclick="selectZone('abdomen')"
                                 style="position: absolute; top: 44%; left: 50%; transform: translateX(-50%); width: 95px; height: 95px; border: 2px solid transparent; cursor: pointer;">
                                <div class="zone-label">BELLY</div>
                            </div>

                            <!-- PELVIS (aligned with skeleton axis) -->
                            <div class="zone-overlay body-zone" data-zone="pelvis" onclick="selectZone('pelvis')"
                                 style="position: absolute; top: 60%; left: 50%; transform: translateX(-50%); width: 85px; height: 75px; border: 2px solid transparent; cursor: pointer;">
                                <div class="zone-label">PELVIS</div>
                            </div>

                            <!-- BRAZOS Left (28% from top, left side) -->
                            <div class="zone-overlay body-zone" data-zone="brazos" onclick="selectZone('brazos')"
                                 style="position: absolute; top: 28%; left: 36%; width: 45px; height: 110px; border: 2px solid transparent; cursor: pointer; transform: rotate(-20deg);">
                                <div class="zone-label" style="transform: rotate(20deg);">ARM-L</div>
                            </div>

                            <!-- BRAZOS Right (28% from top, right side) -->
                            <div class="zone-overlay body-zone" data-zone="brazos" onclick="selectZone('brazos')"
                                 style="position: absolute; top: 28%; right: 36%; width: 45px; height: 110px; border: 2px solid transparent; cursor: pointer; transform: rotate(20deg);">
                                <div class="zone-label" style="transform: rotate(-20deg);">ARM-R</div>
                            </div>

                            <!-- MANOS Left -->
                            <div class="zone-overlay body-zone" data-zone="manos" onclick="selectZone('manos')"
                                 style="position: absolute; top: 48%; left: 30%; width: 35px; height: 35px; border: 2px solid transparent; cursor: pointer; border-radius: 50%;">
                                <div class="zone-label">L</div>
                            </div>

                            <!-- MANOS Right -->
                            <div class="zone-overlay body-zone" data-zone="manos" onclick="selectZone('manos')"
                                 style="position: absolute; top: 48%; right: 30%; width: 35px; height: 35px; border: 2px solid transparent; cursor: pointer; border-radius: 50%;">
                                <div class="zone-label">R</div>
                            </div>

                            <!-- PIERNAS Left (70% from top) -->
                            <div class="zone-overlay body-zone" data-zone="piernas" onclick="selectZone('piernas')"
                                 style="position: absolute; top: 70%; left: 32%; width: 50px; height: 160px; border: 2px solid transparent; cursor: pointer;">
                                <div class="zone-label">LEG-L</div>
                            </div>

                            <!-- PIERNAS Right -->
                            <div class="zone-overlay body-zone" data-zone="piernas" onclick="selectZone('piernas')"
                                 style="position: absolute; top: 70%; right: 32%; width: 50px; height: 160px; border: 2px solid transparent; cursor: pointer;">
                                <div class="zone-label">LEG-R</div>
                            </div>

                            <!-- PIES Left (bottom) -->
                            <div class="zone-overlay body-zone" data-zone="pies" onclick="selectZone('pies')"
                                 style="position: absolute; bottom: 2%; left: 30%; width: 45px; height: 35px; border: 2px solid transparent; cursor: pointer;">
                                <div class="zone-label">L</div>
                            </div>

                            <!-- PIES Right -->
                            <div class="zone-overlay body-zone" data-zone="pies" onclick="selectZone('pies')"
                                 style="position: absolute; bottom: 2%; right: 30%; width: 45px; height: 35px; border: 2px solid transparent; cursor: pointer;">
                                <div class="zone-label">R</div>
                            </div>
                        </div>
                    </div>

                    <!-- Help text -->
                    <div class="absolute bottom-4 left-0 right-0 text-center">
                        <p class="text-medical-green/60 text-xs font-mono uppercase tracking-wider">
                            ‚ñ∏ Selecciona una zona para diagnosticar ‚óÇ
                        </p>
                    </div>
                </div>

                <!-- Quick stats -->
                <div class="grid grid-cols-2 gap-2 lg:grid-cols-4">
                    <div class="zone-card rounded p-3">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="material-symbols-outlined text-medical-green text-sm">event</span>
                            <span class="text-[9px] text-gray-400 font-bold tracking-widest uppercase">Pr√≥xima</span>
                        </div>
                        <div id="proxima-cita-global" class="text-white font-mono text-xs">--</div>
                    </div>
                    <div class="zone-card rounded p-3">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="material-symbols-outlined text-medical-scan text-sm">monitoring</span>
                            <span class="text-[9px] text-gray-400 font-bold tracking-widest uppercase">Revisiones</span>
                        </div>
                        <div id="total-checkups" class="text-white font-mono text-xs">0</div>
                    </div>
                    <div class="zone-card rounded p-3">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="material-symbols-outlined text-yellow-500 text-sm">warning</span>
                            <span class="text-[9px] text-gray-400 font-bold tracking-widest uppercase">Pendientes</span>
                        </div>
                        <div id="pending-checkups" class="text-white font-mono text-xs">0</div>
                    </div>
                    <div class="zone-card rounded p-3">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="material-symbols-outlined text-medical-green text-sm">health_and_safety</span>
                            <span class="text-[9px] text-gray-400 font-bold tracking-widest uppercase">Estado</span>
                        </div>
                        <div id="health-score" class="text-medical-green font-mono text-xs font-bold">100%</div>
                    </div>
                </div>
            </div>

            <!-- === ZONE DETAIL VIEW (Hidden by default) === -->
            <div id="zone-view" class="zoom-view hidden">
                <!-- Back to pod button -->
                <button onclick="backToPod()" class="flex items-center gap-2 mb-4 px-3 py-2 bg-surface-dark border border-medical-green/30 hover:border-medical-green transition-colors">
                    <span class="material-symbols-outlined text-medical-green text-sm">arrow_back</span>
                    <span class="text-medical-green text-xs font-bold uppercase tracking-wider">Volver al Pod</span>
                </button>

                <!-- Zone header -->
                <div class="mb-4 p-4 bg-gradient-to-r from-surface-dark to-surface-accent border-l-4 border-medical-green">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 id="zone-title" class="text-white text-xl font-bold uppercase tracking-wide">Zona Corporal</h3>
                            <p id="zone-description" class="text-gray-400 text-xs mt-1 font-mono"></p>
                        </div>
                        <span id="zone-icon" class="material-symbols-outlined text-medical-green text-4xl"></span>
                    </div>
                </div>

                <!-- === CONDICIONES DE LA ZONA (Lesiones / Afecciones) === -->
                <div id="condiciones-zona" class="mb-5">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <span class="material-symbols-outlined text-red-500 text-base">medical_information</span>
                            <h4 class="text-white text-xs font-bold tracking-widest uppercase">Estado de la Zona</h4>
                        </div>
                        <button onclick="openAddCondicionModal()" class="flex items-center gap-1 px-2 py-1 bg-red-900/20 border border-red-700/50 hover:bg-red-900/40 transition-colors">
                            <span class="material-symbols-outlined text-red-400 text-sm">add</span>
                            <span class="text-red-400 text-xs font-bold uppercase tracking-wider">A√±adir</span>
                        </button>
                    </div>
                    <div id="condiciones-slots" class="grid grid-cols-2 gap-2">
                        <!-- Populated by renderCondicionesSlots() -->
                    </div>
                </div>

                <!-- Zone content (checkups, appointments, etc.) -->
                <div id="zone-content" class="space-y-4">
                    <!-- Will be populated dynamically -->
                </div>
            </div>

        </main>


        <!-- === EDIT CONTROLS PANEL === -->
        <div id="edit-controls" class="edit-controls">
            <div class="edit-controls-header" id="edit-controls-header">
                üìê OVERLAY EDITOR (arrastra para mover)
            </div>
            <div class="edit-control-row">
                <span class="edit-control-label">Zone:</span>
                <input type="text" id="edit-zone-name" class="edit-control-input" readonly style="width: 100px;">
            </div>
            <div class="edit-control-row">
                <span class="edit-control-label">Pos:</span>
                <input type="text" id="edit-position" class="edit-control-input" readonly style="width: 150px;">
            </div>
            <div class="edit-control-row">
                <span class="edit-control-label">Rot:</span>
                <button class="edit-control-btn" onclick="adjustRotation(-5)">-5¬∞</button>
                <input type="number" id="edit-rotation" class="edit-control-input" value="0" style="text-align: center; width: 60px;">
                <button class="edit-control-btn" onclick="adjustRotation(5)">+5¬∞</button>
            </div>
            <div class="edit-control-row">
                <span class="edit-control-label">W:</span>
                <button class="edit-control-btn" onclick="adjustSize('width', -5)">-</button>
                <input type="number" id="edit-width" class="edit-control-input" value="0" style="text-align: center; width: 50px;">
                <button class="edit-control-btn" onclick="adjustSize('width', 5)">+</button>
            </div>
            <div class="edit-control-row">
                <span class="edit-control-label">H:</span>
                <button class="edit-control-btn" onclick="adjustSize('height', -5)">-</button>
                <input type="number" id="edit-height" class="edit-control-input" value="0" style="text-align: center; width: 50px;">
                <button class="edit-control-btn" onclick="adjustSize('height', 5)">+</button>
            </div>
            <button class="edit-control-btn" onclick="copyOverlayCSS()">üìã CSS</button>
            <button class="edit-control-btn" onclick="deselectOverlay()">‚ùå</button>
        </div>

        <!-- === HISTORIAL CL√çNICO VIEW === -->
        <div id="historial-view" class="hidden px-3 pb-28">

            <!-- Filtros por subtipo -->
            <div id="historial-filters" class="flex gap-1.5 overflow-x-auto hide-scrollbar mb-4 pb-1" style="flex-wrap: nowrap;">
                <button onclick="setHistorialFiltro('todos')" data-filtro="todos"
                    class="historial-filtro-btn active-filtro flex-shrink-0 px-3 py-1 rounded text-[10px] font-mono font-bold uppercase tracking-widest transition-all border border-white/20 text-white bg-white/10">
                    TODOS
                </button>
                <button onclick="setHistorialFiltro('visita')" data-filtro="visita"
                    class="historial-filtro-btn flex-shrink-0 px-3 py-1 rounded text-[10px] font-mono font-bold uppercase tracking-widest transition-all border border-[#2d2d2d] text-gray-500 hover:border-blue-500 hover:text-blue-400">
                    <span class="material-symbols-outlined text-xs" style="vertical-align:middle">local_hospital</span> VISITA
                </button>
                <button onclick="setHistorialFiltro('medicamento')" data-filtro="medicamento"
                    class="historial-filtro-btn flex-shrink-0 px-3 py-1 rounded text-[10px] font-mono font-bold uppercase tracking-widest transition-all border border-[#2d2d2d] text-gray-500 hover:border-green-500 hover:text-green-400">
                    <span class="material-symbols-outlined text-xs" style="vertical-align:middle">medication</span> MEDICAMENTO
                </button>
                <button onclick="setHistorialFiltro('analisis')" data-filtro="analisis"
                    class="historial-filtro-btn flex-shrink-0 px-3 py-1 rounded text-[10px] font-mono font-bold uppercase tracking-widest transition-all border border-[#2d2d2d] text-gray-500 hover:border-amber-500 hover:text-amber-400">
                    <span class="material-symbols-outlined text-xs" style="vertical-align:middle">biotech</span> AN√ÅLISIS
                </button>
                <button onclick="setHistorialFiltro('vacuna')" data-filtro="vacuna"
                    class="historial-filtro-btn flex-shrink-0 px-3 py-1 rounded text-[10px] font-mono font-bold uppercase tracking-widest transition-all border border-[#2d2d2d] text-gray-500 hover:border-purple-500 hover:text-purple-400">
                    <span class="material-symbols-outlined text-xs" style="vertical-align:middle">vaccines</span> VACUNA
                </button>
            </div>

            <!-- Timeline renderizada por JS -->
            <div id="historial-list" class="space-y-2"></div>

            <!-- Empty state -->
            <div id="historial-empty" class="hidden py-12 text-center">
                <span class="material-symbols-outlined text-5xl text-gray-700 mb-3 block">history_edu</span>
                <p class="text-gray-500 text-xs font-mono uppercase tracking-widest">/// Sin entradas en el historial ///</p>
                <p class="text-gray-600 text-[10px] mt-1">Registra tu primera consulta, medicamento, an√°lisis o vacuna</p>
            </div>
        </div>

        <!-- === AGENDA VIEW (oculta por defecto) === -->
        <div id="agenda-view" class="hidden px-3 pb-28">
            <!-- Pr√≥xima cita destacada -->
            <div id="proxima-cita-card" class="hidden mb-4 rounded-lg p-4 border"
                style="background: rgba(20,184,166,0.05); border-color: rgba(20,184,166,0.3);">
                <div class="flex items-center gap-2 mb-2">
                    <span class="material-symbols-outlined text-teal-400 text-base">calendar_month</span>
                    <span class="text-teal-400 text-[10px] font-mono font-bold uppercase tracking-widest">Pr√≥xima cita</span>
                </div>
                <div id="proxima-cita-titulo" class="text-white font-bold text-sm mb-1"></div>
                <div id="proxima-cita-meta" class="text-teal-400/70 text-[11px] font-mono"></div>
                <div id="proxima-cita-countdown" class="text-teal-400 text-[10px] font-mono mt-2 font-bold"></div>
                <div class="flex gap-2 mt-3">
                    <button id="proxima-completar-btn" onclick="" class="flex-1 py-1.5 rounded text-[10px] font-mono font-bold uppercase tracking-widest border border-teal-500 text-teal-400 hover:bg-teal-500/10 transition-all">
                        <span class="material-symbols-outlined text-xs align-middle">check_circle</span> Completada
                    </button>
                    <button id="proxima-editar-btn" onclick="" class="px-3 py-1.5 rounded text-[10px] font-mono font-bold uppercase tracking-widest border border-gray-700 text-gray-500 hover:border-blue-500/50 hover:text-blue-400 transition-all">
                        <span class="material-symbols-outlined text-xs align-middle">edit</span>
                    </button>
                </div>
            </div>

            <!-- Timeline citas -->
            <div id="agenda-list" class="space-y-2"></div>

            <!-- Empty state -->
            <div id="agenda-empty" class="hidden text-center py-12">
                <span class="material-symbols-outlined text-4xl text-gray-700">calendar_month</span>
                <p class="text-gray-500 text-xs font-mono uppercase tracking-widest mt-2">/// Sin citas programadas ///</p>
                <p class="text-gray-600 text-[10px] mt-1">Pulsa + para registrar una cita m√©dica</p>
            </div>
        </div>

        <!-- FAB a√±adir historial (visible solo en vista historial) -->
        <button id="fab-historial"
            onclick="openHistorialModal()"
            class="hidden fixed bottom-20 right-4 lg:bottom-8 lg:right-8 w-14 h-14 rounded-full shadow-2xl flex items-center justify-center z-30 transition-all active:scale-95"
            style="background: #1d4ed8; border: 1.5px solid #3b82f6;">
            <span class="material-symbols-outlined text-white text-2xl">add</span>
        </button>

        <!-- FAB a√±adir cita (visible solo en vista agenda) -->
        <button id="fab-agenda"
            onclick="openCitaModal()"
            class="hidden fixed bottom-20 right-4 lg:bottom-8 lg:right-8 w-14 h-14 rounded-full shadow-2xl flex items-center justify-center z-30 transition-all active:scale-95"
            style="background: #0f766e; border: 1.5px solid #14b8a6;">
            <span class="material-symbols-outlined text-white text-2xl">add</span>
        </button>

        <!-- === MODAL NUEVA CITA M√âDICA === -->
        <div id="modal-cita" class="modal-overlay fixed inset-0 z-50 hidden items-center justify-center" onclick="if(event.target===this)closeCitaModal()">
            <div class="modal-content" style="max-height: 90dvh; overflow-y: auto;">
                <div class="modal-header p-4 flex items-center justify-between sticky top-0 bg-[#1a1718] z-10">
                    <h3 class="text-white font-bold text-lg uppercase tracking-wide">Nueva Cita</h3>
                    <button onclick="closeCitaModal()" class="text-gray-400 hover:text-white">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="p-4 space-y-4">
                    <!-- Motivo -->
                    <div>
                        <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Motivo / Nombre *</label>
                        <input id="cita-motivo" type="text" placeholder="Ej: Revisi√≥n cardiol√≥gica anual..."
                            class="w-full bg-[#111] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm placeholder-gray-600 focus:border-teal-500 focus:outline-none">
                    </div>
                    <!-- Fecha y Hora -->
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Fecha *</label>
                            <input id="cita-fecha" type="date"
                                class="w-full bg-[#111] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:border-teal-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Hora</label>
                            <input id="cita-hora" type="time" value="09:00"
                                class="w-full bg-[#111] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:border-teal-500 focus:outline-none">
                        </div>
                    </div>
                    <!-- M√©dico y Especialidad -->
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">M√©dico / Centro</label>
                            <input id="cita-medico" type="text" placeholder="Dr. Garc√≠a..."
                                class="w-full bg-[#111] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm placeholder-gray-600 focus:border-teal-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Especialidad</label>
                            <input id="cita-especialidad" type="text" placeholder="Cardiolog√≠a..."
                                class="w-full bg-[#111] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm placeholder-gray-600 focus:border-teal-500 focus:outline-none">
                        </div>
                    </div>
                    <!-- Zona y Frecuencia -->
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Zona corporal</label>
                            <select id="cita-zona" class="w-full bg-[#111] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:border-teal-500 focus:outline-none">
                                <option value="general">General</option>
                                <option value="cabeza">Cabeza</option>
                                <option value="torso">Torso</option>
                                <option value="abdomen">Abdomen</option>
                                <option value="pelvis">Pelvis</option>
                                <option value="brazos">Brazos</option>
                                <option value="manos">Manos</option>
                                <option value="piernas">Piernas</option>
                                <option value="pies">Pies</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Frecuencia</label>
                            <select id="cita-frecuencia" class="w-full bg-[#111] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:border-teal-500 focus:outline-none">
                                <option value="none">No se repite</option>
                                <option value="monthly">Mensual</option>
                                <option value="quarterly">Trimestral</option>
                                <option value="biannual">Semestral</option>
                                <option value="yearly">Anual</option>
                            </select>
                        </div>
                    </div>
                    <!-- Notas -->
                    <div>
                        <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Notas</label>
                        <textarea id="cita-notas" rows="2" placeholder="Observaciones adicionales..."
                            class="w-full bg-[#111] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm placeholder-gray-600 focus:border-teal-500 focus:outline-none resize-none"></textarea>
                    </div>
                    <!-- Condici√≥n vinculada -->
                    <div>
                        <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Vincular a condici√≥n (opcional)</label>
                        <select id="cita-condicion" class="w-full bg-[#111] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:border-teal-500 focus:outline-none">
                            <option value="">‚Äî Ninguna ‚Äî</option>
                        </select>
                    </div>
                    <!-- Acciones -->
                    <div class="flex gap-3 pt-2">
                        <button onclick="closeCitaModal()" class="flex-1 py-2.5 rounded border border-[#2d2d2d] text-gray-400 text-sm font-mono uppercase tracking-widest hover:border-gray-500 transition-all">Cancelar</button>
                        <button onclick="saveCita()"
                            class="flex-1 py-2.5 rounded text-sm font-mono font-bold uppercase tracking-widest transition-all"
                            style="background: #14b8a6; color: #fff; border: 1.5px solid #0d9488;">Guardar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- === MODAL HISTORIAL CL√çNICO === -->
        <div id="modal-historial" class="modal-overlay fixed inset-0 z-50 hidden items-center justify-center" onclick="if(event.target===this)closeHistorialModal()">
            <div class="modal-content" style="max-height: 90dvh; overflow-y: auto;">
                <div class="modal-header p-4 flex items-center justify-between sticky top-0 bg-[#1a1718] z-10">
                    <h3 class="text-white font-bold text-lg uppercase tracking-wide">Nueva Entrada</h3>
                    <button onclick="closeHistorialModal()" class="text-gray-400 hover:text-white">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="p-4 space-y-4">
                    <!-- Selector subtipo -->
                    <div>
                        <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-2">Tipo de entrada</label>
                        <div class="grid grid-cols-2 gap-2">
                            <button id="hist-btn-visita" onclick="setSubtipoHistorial('visita')"
                                class="hist-subtipo-btn flex items-center gap-2 px-3 py-2 rounded border border-[#2d2d2d] text-gray-500 text-sm transition-all hover:border-blue-500 hover:text-blue-400">
                                <span class="material-symbols-outlined text-base">local_hospital</span>Visita
                            </button>
                            <button id="hist-btn-medicamento" onclick="setSubtipoHistorial('medicamento')"
                                class="hist-subtipo-btn flex items-center gap-2 px-3 py-2 rounded border border-[#2d2d2d] text-gray-500 text-sm transition-all hover:border-green-500 hover:text-green-400">
                                <span class="material-symbols-outlined text-base">medication</span>Medicamento
                            </button>
                            <button id="hist-btn-analisis" onclick="setSubtipoHistorial('analisis')"
                                class="hist-subtipo-btn flex items-center gap-2 px-3 py-2 rounded border border-[#2d2d2d] text-gray-500 text-sm transition-all hover:border-amber-500 hover:text-amber-400">
                                <span class="material-symbols-outlined text-base">biotech</span>An√°lisis
                            </button>
                            <button id="hist-btn-vacuna" onclick="setSubtipoHistorial('vacuna')"
                                class="hist-subtipo-btn flex items-center gap-2 px-3 py-2 rounded border border-[#2d2d2d] text-gray-500 text-sm transition-all hover:border-purple-500 hover:text-purple-400">
                                <span class="material-symbols-outlined text-base">vaccines</span>Vacuna
                            </button>
                        </div>
                    </div>

                    <!-- Campos comunes -->
                    <div>
                        <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">T√≠tulo *</label>
                        <input type="text" id="hist-titulo" placeholder="Ej: Revisi√≥n cardiol√≥gica anual..."
                            class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-medical-green">
                    </div>
                    <div>
                        <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Fecha *</label>
                        <input type="date" id="hist-fecha"
                            class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-medical-green">
                    </div>

                    <!-- Campos espec√≠ficos: VISITA -->
                    <div id="hist-campos-visita" class="hidden space-y-3">
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">M√©dico</label>
                            <input type="text" id="hist-medico" placeholder="Nombre del m√©dico"
                                class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Especialidad</label>
                            <input type="text" id="hist-especialidad" placeholder="Cardiolog√≠a, Traumatolog√≠a..."
                                class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Diagn√≥stico</label>
                            <input type="text" id="hist-diagnostico" placeholder="Diagn√≥stico o conclusi√≥n"
                                class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Tratamiento</label>
                            <input type="text" id="hist-tratamiento" placeholder="Tratamiento prescrito"
                                class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-blue-500">
                        </div>
                    </div>

                    <!-- Campos espec√≠ficos: MEDICAMENTO -->
                    <div id="hist-campos-medicamento" class="hidden space-y-3">
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Nombre del medicamento</label>
                            <input type="text" id="hist-nombre-medicamento" placeholder="Ibuprofeno, Paracetamol..."
                                class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-green-500">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Dosis</label>
                                <input type="text" id="hist-dosis" placeholder="500mg, 1 comprimido..."
                                    class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-green-500">
                            </div>
                            <div>
                                <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Pauta</label>
                                <input type="text" id="hist-pauta" placeholder="Cada 8h, 1 vez/d√≠a..."
                                    class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-green-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Fecha fin</label>
                            <input type="date" id="hist-fecha-fin"
                                class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-green-500">
                        </div>
                    </div>

                    <!-- Campos espec√≠ficos: AN√ÅLISIS -->
                    <div id="hist-campos-analisis" class="hidden space-y-3">
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Tipo de an√°lisis</label>
                            <input type="text" id="hist-tipo-analisis" placeholder="Anal√≠tica sangre, ECG, Radiograf√≠a..."
                                class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-amber-500">
                        </div>
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Resultado</label>
                            <input type="text" id="hist-resultado" placeholder="Normal, valores alterados..."
                                class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-amber-500">
                        </div>
                    </div>

                    <!-- Campos espec√≠ficos: VACUNA -->
                    <div id="hist-campos-vacuna" class="hidden space-y-3">
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Nombre de la vacuna</label>
                            <input type="text" id="hist-nombre-vacuna" placeholder="Gripe, T√©tanos, COVID..."
                                class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-purple-500">
                        </div>
                        <div>
                            <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Pr√≥xima dosis</label>
                            <input type="date" id="hist-siguiente-dosis"
                                class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-purple-500">
                        </div>
                    </div>

                    <!-- Notas comunes -->
                    <div>
                        <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Notas</label>
                        <textarea id="hist-notas" rows="2" placeholder="Observaciones adicionales..."
                            class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-medical-green resize-none"></textarea>
                    </div>

                    <!-- Vincular a condici√≥n -->
                    <div>
                        <label class="block text-[10px] font-mono text-gray-400 uppercase tracking-widest mb-1">Vincular a condici√≥n (opcional)</label>
                        <select id="hist-condicion-select"
                            class="w-full bg-[#0f0f10] border border-[#2d2d2d] rounded px-3 py-2 text-white text-sm focus:outline-none focus:border-medical-green">
                            <option value="">‚Äî Ninguna ‚Äî</option>
                        </select>
                    </div>

                    <!-- Botones -->
                    <div class="flex gap-3 pt-2">
                        <button onclick="closeHistorialModal()"
                            class="flex-1 py-2 border border-[#2d2d2d] rounded text-gray-400 text-sm hover:text-white hover:border-gray-500 transition-colors">
                            Cancelar
                        </button>
                        <button onclick="saveHistorial()"
                            class="flex-1 py-2 rounded text-sm font-bold transition-colors text-black"
                            style="background: #22c55e;">
                            Guardar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- === MODAL ADD CHECKUP === -->
        <div id="modal-checkup" class="modal-overlay fixed inset-0 z-50 hidden items-center justify-center" onclick="if(event.target===this)closeCheckupModal()">
            <div class="modal-content">
                <div class="modal-header p-4 flex items-center justify-between">
                    <h3 class="text-white font-bold text-lg uppercase tracking-wide">A√±adir Revisi√≥n</h3>
                    <button onclick="closeCheckupModal()" class="text-gray-500 hover:text-white">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="modal-body p-4 space-y-4">
                    <input type="hidden" id="checkup-zone">

                    <div class="form-group">
                        <label class="form-label">Tipo de Revisi√≥n</label>
                        <input type="text" id="checkup-name" class="form-input" placeholder="Ej: Revisi√≥n dental, Anal√≠ticas...">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Fecha de la Cita</label>
                        <input type="date" id="checkup-date" class="form-input">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Hora</label>
                        <input type="time" id="checkup-time" class="form-input" value="09:00">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Doctor / Centro</label>
                        <input type="text" id="checkup-doctor" class="form-input" placeholder="Dr. Nombre / Cl√≠nica">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Notas</label>
                        <textarea id="checkup-notes" class="form-textarea" placeholder="Detalles adicionales..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Frecuencia</label>
                        <select id="checkup-frequency" class="form-select">
                            <option value="none">Sin repetir</option>
                            <option value="yearly">Anual</option>
                            <option value="biannual">Semestral</option>
                            <option value="quarterly">Trimestral</option>
                            <option value="monthly">Mensual</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer p-4 flex items-center justify-end gap-3">
                    <button onclick="closeCheckupModal()" class="btn-secondary">Cancelar</button>
                    <button onclick="saveCheckup()" class="btn-primary">Guardar</button>
                </div>
            </div>
        </div>

        <!-- === MODAL ADD CONDICI√ìN (Lesi√≥n / Afecci√≥n) === -->
        <div id="modal-condicion" class="modal-overlay fixed inset-0 z-50 hidden items-center justify-center" onclick="if(event.target===this)closeCondicionModal()">
            <div class="modal-content">
                <div class="modal-header p-4 flex items-center justify-between">
                    <h3 class="text-white font-bold text-lg uppercase tracking-wide">A√±adir Condici√≥n</h3>
                    <button onclick="closeCondicionModal()" class="text-gray-500 hover:text-white">
                        <span class="material-symbols-outlined">close</span>
                    </button>
                </div>
                <div class="modal-body p-4 space-y-4">
                    <input type="hidden" id="condicion-zona">
                    <input type="hidden" id="condicion-editar-id">

                    <!-- Tipo: Lesi√≥n / Afecci√≥n -->
                    <div class="form-group">
                        <label class="form-label">Tipo de Condici√≥n</label>
                        <div class="flex gap-2">
                            <button id="tipo-lesion-btn" onclick="setTipoCondicion('lesion')"
                                class="flex-1 py-2 px-3 border-2 border-red-600 bg-red-900/40 text-red-300 text-xs font-bold uppercase tracking-wider transition-all">
                                üî¥ Lesi√≥n Permanente
                            </button>
                            <button id="tipo-afeccion-btn" onclick="setTipoCondicion('afeccion')"
                                class="flex-1 py-2 px-3 border border-gray-600 bg-gray-800/40 text-gray-400 text-xs font-bold uppercase tracking-wider transition-all">
                                üü° Afecci√≥n Pasajera
                            </button>
                        </div>
                        <input type="hidden" id="condicion-tipo" value="lesion">
                    </div>

                    <!-- Nombre -->
                    <div class="form-group">
                        <label class="form-label">Nombre</label>
                        <input type="text" id="condicion-nombre" class="form-input" placeholder="Ej: Fractura curada, Orzuelo, Esguince...">
                    </div>

                    <!-- Severidad -->
                    <div class="form-group">
                        <label class="form-label">Severidad</label>
                        <select id="condicion-severidad" class="form-select">
                            <option value="leve">üü¢ Leve</option>
                            <option value="moderada">üü† Moderada</option>
                            <option value="grave">üî¥ Grave</option>
                        </select>
                    </div>

                    <!-- Fecha Inicio -->
                    <div class="form-group">
                        <label class="form-label">Fecha de Inicio</label>
                        <input type="date" id="condicion-fecha-inicio" class="form-input">
                    </div>

                    <!-- Notas -->
                    <div class="form-group">
                        <label class="form-label">Notas / Descripci√≥n</label>
                        <textarea id="condicion-notas" class="form-textarea" placeholder="S√≠ntomas, tratamiento, contexto..."></textarea>
                    </div>

                    <!-- Fecha resoluci√≥n (solo afecciones) -->
                    <div id="condicion-resolucion-grupo" class="form-group hidden">
                        <label class="form-label">Fecha Estimada de Resoluci√≥n</label>
                        <input type="date" id="condicion-fecha-resolucion" class="form-input">
                    </div>
                </div>
                <div class="modal-footer p-4 flex items-center justify-end gap-3">
                    <button onclick="closeCondicionModal()" class="btn-secondary">Cancelar</button>
                    <button onclick="saveCondicion()" class="btn-primary">Guardar</button>
                </div>
            </div>
        </div>

        <!-- === BOTTOM NAVIGATION === -->
        <nav class="lg:hidden fixed bottom-0 w-full max-w-md bg-[#161011] border-t border-[#332224] h-16 flex items-center justify-around z-40 backdrop-blur-md bg-opacity-95">
            <a href="index.html" class="flex flex-col items-center justify-center w-full h-full text-gray-500 hover:text-gray-300 hover:bg-[#1e1617]">
                <span class="material-symbols-outlined text-2xl mb-0.5">dashboard</span>
                <span class="text-[9px] font-bold tracking-widest uppercase">Bridge</span>
            </a>
            <a href="duty.html" class="flex flex-col items-center justify-center w-full h-full text-gray-500 hover:text-gray-300 hover:bg-[#1e1617]">
                <span class="material-symbols-outlined text-2xl mb-0.5">task_alt</span>
                <span class="text-[9px] font-bold tracking-widest uppercase">Duty</span>
            </a>
            <a href="voidmap.html" class="flex flex-col items-center justify-center w-full h-full text-gray-500 hover:text-gray-300 hover:bg-[#1e1617]">
                <span class="material-symbols-outlined text-2xl mb-0.5">public</span>
                <span class="text-[9px] font-bold tracking-widest uppercase">Void</span>
            </a>
            <a href="directivas.html" class="flex flex-col items-center justify-center w-full h-full text-gray-500 hover:text-gray-300 hover:bg-[#1e1617]">
                <span class="material-symbols-outlined text-2xl mb-0.5">target</span>
                <span class="text-[9px] font-bold tracking-widest uppercase">Direct.</span>
            </a>
            <a href="cargo.html" class="flex flex-col items-center justify-center w-full h-full text-gray-500 hover:text-gray-300 hover:bg-[#1e1617]">
                <span class="material-symbols-outlined text-2xl mb-0.5">inventory_2</span>
                <span class="text-[9px] font-bold tracking-widest uppercase">Cargo</span>
            </a>
            <a href="economato.html" class="flex flex-col items-center justify-center w-full h-full text-gray-500 hover:text-gray-300 hover:bg-[#1e1617]">
                <span class="material-symbols-outlined text-2xl mb-0.5">account_balance</span>
                <span class="text-[9px] font-bold tracking-widest uppercase">Econo.</span>
            </a>
            <a href="bahia-medica.html" class="flex flex-col items-center justify-center w-full h-full text-medical-green hover:bg-[#1e1617] relative">
                <span class="material-symbols-outlined text-2xl mb-0.5">medical_services</span>
                <span class="text-[9px] font-bold tracking-widest uppercase">M√©dica</span>
                <div class="absolute top-0 w-full h-0.5 bg-medical-green shadow-[0_0_8px_rgba(34,197,94,0.8)]"></div>
            </a>
        </nav>
    </div>

    <script src="db.js"></script>
    <script src="sync-utils.js"></script>
    <script src="bahia-medica.js"></script>
<!-- Service Worker Registration -->
<script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js')
            .then((registration) => {
                console.log('SW registered:', registration.scope);
                registration.addEventListener('updatefound', () => {
                    const newWorker = registration.installing;
                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            newWorker.postMessage('skipWaiting');
                        }
                    });
                });
            })
            .catch((error) => {
                console.log('SW registration failed:', error);
            });
    }
</script>
</body>
</html>
